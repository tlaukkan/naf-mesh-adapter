<!DOCTYPE html>
<html>
<head>
    <title>A-Frame Mesh Adapter Demo</title>
    <meta name="description" content="Hello, WebVR! - A-Frame">
    <script src="https://aframe.io/releases/0.8.2/aframe.min.js"></script>
    <script src="https://rawgit.com/feiss/aframe-environment-component/master/dist/aframe-environment-component.min.js"></script>
    <script src="networked-aframe.js"></script>
    <script src="bundle.js"></script>
</head>
<body>
<script>
    NAF.options.updateRate = 10
    NAF.options.debug = true
</script>

<a-scene networked-scene="room: dev; debug: true; adapter: mesh; serverURL: wss://tlaukkan-webrtc-signaling.herokuapp.com/31980bbf28e4b66e72ab49bebeb20da4f67a090c514d56c549f26caaf65a076c;">
    <a-assets>
        <template id="server-peer-template">
            <a-entity>
                <a-entity>
                    <a-animation
                            attribute="rotation"
                            easing="linear"
                            dur="30000"
                            to="360 720 1080"
                            repeat="indefinite">
                    </a-animation>
                    <a-tetrahedron color="#ADD8E6" radius="0.2" rotation="0 0 60" material="opacity: 0.5; transparent: true"></a-tetrahedron>
                </a-entity>
            </a-entity>
        </template>
        <template id="client-peer-template">
            <a-entity>
                <a-entity>
                    <a-animation
                            attribute="rotation"
                            easing="linear"
                            dur="30000"
                            to="360 720 1080"
                            repeat="indefinite">
                    </a-animation>
                    <a-tetrahedron color="#ADD8E6" radius="0.2" rotation="0 0 60" material="opacity: 0.7; transparent: true"></a-tetrahedron>
                </a-entity>
            </a-entity>
        </template>
    </a-assets>

    <a-entity id="environment" environment="lighting: none; lightPosition: 1 5 -2; ground: none; fog: none; groundTexture: none; groundColor: #FFFFFF; groundColor2: #FFFFFF; horizonColor: #7ae0e0;">
        <a-plane color="#DDDDDD" height="1000" width="1000" rotation="-90 0 0"></a-plane>
    </a-entity>

    <a-entity light="type: directional; color: #FFF; intensity: 0.6" position="1 5 -2"></a-entity>
    <a-entity light="type: ambient; color: #555555"></a-entity>

    <!--<a-tetrahedron color="#29AB87" radius="0.2" rotation="0 0 60" material="opacity: 0.7; transparent: true"></a-tetrahedron>-->

    <a-entity id="adapter" networked="template:#client-peer-template;attachTemplateToLocal:true;" position="0 1 0">
        <a-animation
                attribute="rotation"
                easing="linear"
                dur="30000"
                to="360 720 1080"
                repeat="indefinite">
        </a-animation>
    </a-entity>

    <a-entity id="player" camera wasd-controls look-controls position="0 1.5 5">
    </a-entity>

</a-scene>

<script>
    var player = document.getElementById('player');
    var environment = document.getElementById('environment');
    setInterval(() => {
        var position = player.getAttribute('position')
        if (position) {
            environment.setAttribute('position', {x: position.x, y: position.y - 1.5, z: position.z})
        }
    }, 1000);
</script>

</body>
</html>